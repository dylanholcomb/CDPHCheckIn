# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrOvertime:
    Properties:
      Fill: =RGBA(153, 207, 236, 1)
      LoadingSpinnerColor: =RGBA(56, 96, 178, 1)
      OnVisible: |-
        =Refresh(spo_LogList);

        ClearCollect(
            colToday,
            Filter(
                spo_LogList,
                Lower(EmployeeUPN) = varUserEmail && DateValue(Date) = Today()
            )
        );

        // Optional safety gate
        If(
            CountRows(colToday) = 0,
            Notify("No Daily Log entry found for today.", NotificationType.Error);
            Back()
        );
    Children:
      - inpOTNotes:
          Control: Classic/TextInput@2.3.2
          Properties:
            BorderColor: =RGBA(0, 94, 146, 1)
            Clear: =true
            Default: |-
              =If(
                  CountRows(colToday) = 0,
                  "",
                  Coalesce(First(colToday).OvertimeNotes, "")
              )
            Font: =Font.Arial
            Height: =111
            HintText: ="Overtime Tasks"
            HoverBorderColor: =RGBA(0, 18, 107, 1)
            HoverFill: =RGBA(186, 202, 226, 1)
            Mode: =TextMode.MultiLine
            PaddingLeft: =5
            Size: =20
            Tooltip: ="Type Here To Describe Estimated Task 1"
            Width: =361
            X: =394
            Y: =215
      - TitleOvertime:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Height: =73
            Size: =45
            Text: ="Overtime Entry"
            Width: =485
            X: =445
            Y: =74
      - inpOTHours:
          Control: Classic/TextInput@2.3.2
          Properties:
            BorderColor: =RGBA(0, 18, 107, 1)
            Default: |-
              =If(
                  CountRows(colToday) = 0 || IsBlank(First(colToday).OvertimeHours),
                  "",
                  Text(First(colToday).OvertimeHours)
              )
            Font: =Font.Arial
            Format: =TextFormat.Number
            Height: =58
            HintText: ="OT Hour(s)"
            HoverBorderColor: =RGBA(0, 18, 107, 1)
            HoverFill: =RGBA(186, 202, 226, 1)
            Size: =20
            Tooltip: ="Type Here Your Estimated Hours For Task 1"
            Width: =170
            X: =783
            Y: =242
      - btnSaveOT:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            DisplayMode: |-
              =If(
                  CountRows(colToday) > 0 && IsNumeric(inpOTHours.Text) && Value(inpOTHours.Text) >= 0,
                  DisplayMode.Edit,
                  DisplayMode.Disabled
              )
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.Arial
            Height: =90
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: |-
              =If(
                  CountRows(colToday) = 0,
                  Notify("No Daily Log row found for today.", NotificationType.Error),

                  If(
                      !IsNumeric(inpOTHours.Text) || Value(inpOTHours.Text) < 0,
                      Notify("Please enter a valid overtime number (0 or greater).", NotificationType.Error),

                      Patch(
                          spo_LogList,
                          First(colToday),
                          {
                              OvertimeHours: Value(inpOTHours.Text),
                              OvertimeNotes: If(IsBlank(inpOTNotes.Text), Blank(), inpOTNotes.Text)
                          }
                      );

                      // Refresh local cache so Home reflects latest if needed
                      Refresh(spo_LogList);
                      ClearCollect(
                          colToday,
                          Filter(
                              spo_LogList,
                              Lower(EmployeeUPN) = varUserEmail && DateValue(Date) = Today()
                          )
                      );

                      Notify("Overtime saved.", NotificationType.Success);
                      Back()
                  )
              )
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Size: =25
            Text: ="Save"
            Width: =250
            X: =1077
            Y: =648
      - btnCancelOT:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(56, 96, 178, 1)
            Font: =Font.Arial
            Height: =90
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: =Back()
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Size: =25
            Text: ="Cancel"
            Width: =250
            X: =48
            Y: =648
      - Label3:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 18, 107, 1)
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Height: =132
            Size: =25
            Text: ="Please use the boxes above to enter all overtime tasks and hours combined."
            Width: =680
            X: =347
            Y: =408
